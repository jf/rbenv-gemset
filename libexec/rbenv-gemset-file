#!/usr/bin/env bash
set -e

locate_local_gemsets_file_from() {
  local root="$1"
  while [ -n "$root" ]; do
    if [ -e "${root}/.rbenv-gemsets" ]; then
      echo "${root}/.rbenv-gemsets"
      exit
    elif [ -e "${root}/.ruby-gemset" ]; then
      echo "${root}/.ruby-gemset"
      exit
    fi
    root="${root%/*}"
  done
}

RBENV_VERSION_DIR="$(dirname "$(rbenv version-file)")"

# follow rbenv's leading for where to go for config, unless
# we have an explicit `$RBENV_GEMSET_FILE`!
if [ -e "$RBENV_GEMSET_FILE" ]; then
  echo "$RBENV_GEMSET_FILE"
  exit
else
  locate_local_gemsets_file_from "$RBENV_DIR"
fi
